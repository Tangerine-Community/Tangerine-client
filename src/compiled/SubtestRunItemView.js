var SubtestRunItemView;

SubtestRunItemView = Backbone.Marionette.ItemView.extend({
  tagName: 'p',
  template: JST["SubtestRunItemView"],
  className: "SubtestRunItemView",
  events: {
    'click .subtest-next': 'next',
    'click .subtest-back': 'back',
    'click .subtest_help': 'toggleHelp',
    'click .skip': 'skip'
  },
  toggleHelp: function() {
    return this.$el.find(".enumerator_help").fadeToggle(250);
  },
  i18n: function() {
    return this.text = {
      "next": t("SubtestRunView.button.next"),
      "back": t("SubtestRunView.button.back"),
      "skip": t("SubtestRunView.button.skip"),
      "help": t("SubtestRunView.button.help")
    };
  },
  initialize: function(options) {
    var backable, skippable, ui;
    this.i18n();
    this.model = options.model;
    this.parent = this.model.parent;
    if (this.model.get("fontFamily") !== "") {
      this.fontStyle = "style=\"font-family: " + (this.model.get('fontFamily')) + " !important;\"";
    }
    this.prototypeRendered = false;
    this.delegateEvents();
    ui = {};
    ui.enumeratorHelp = (this.model.get("enumeratorHelp") || "") !== "" ? "<button class='subtest_help command'>" + this.text.help + "</button><div class='enumerator_help' " + (this.fontStyle || "") + ">" + (this.model.get('enumeratorHelp')) + "</div>" : "";
    ui.studentDialog = (this.model.get("studentDialog") || "") !== "" ? "<div class='student_dialog' " + (this.fontStyle || "") + ">" + (this.model.get('studentDialog')) + "</div>" : "";
    ui.transitionComment = (this.model.get("transitionComment") || "") !== "" ? "<div class='student_dialog' " + (this.fontStyle || "") + ">" + (this.model.get('transitionComment')) + "</div> <br>" : "";
    skippable = this.model.get("skippable") === true || this.model.get("skippable") === "true";
    backable = (this.model.get("backButton") === true || this.model.get("backButton") === "true") && this.parent.index !== 0;
    if (skippable) {
      ui.skipButton = "<button class='skip navigation'>" + this.text.skip + "</button>";
    }
    if (backable) {
      ui.backButton = "<button class='subtest-back navigation'>" + this.text.back + "</button>";
    }
    ui.text = this.text;
    return this.model.set('ui', ui);
  },
  onRender: function() {
    var _render, languageCode;
    _render = (function(_this) {
      return function() {
        console.log(_this.model);
        _this.prototypeView = new window[(_this.model.get('prototype').titleize()) + "RunView"]({
          model: _this.model,
          parent: _this
        });
        _this.prototypeView.on("rendered", function() {
          return _this.flagRender("prototype");
        });
        _this.prototypeView.on("subRendered", function() {
          return _this.trigger("subRendered");
        });
        _this.prototypeView.on("showNext", function() {
          return _this.showNext();
        });
        _this.prototypeView.on("hideNext", function() {
          return _this.hideNext();
        });
        _this.prototypeView.on("ready", function() {
          return _this.prototypeRendered = true;
        });
        _this.prototypeView.setElement(_this.$el.find('#prototype_wrapper'));
        _this.prototypeView.render();
        return _this.flagRender("subtest");
      };
    })(this);
    languageCode = this.model.get("language");
    if (languageCode) {
      return i18n.setLng(languageCode, (function(_this) {
        return function(t) {
          window.t = t;
          return _render();
        };
      })(this));
    } else {
      return i18n.setLng(Tangerine.settings.get("language"), (function(_this) {
        return function(t) {
          return _render();
        };
      })(this));
    }
  },
  flagRender: (function(_this) {
    return function(flag) {
      if (!_this.renderFlags) {
        _this.renderFlags = {};
      }
      _this.renderFlags[flag] = true;
      if (_this.renderFlags['subtest'] && _this.renderFlags['prototype']) {
        return _this.trigger("rendered");
      }
    };
  })(this),
  afterRender: (function(_this) {
    return function() {
      var ref;
      if ((ref = _this.prototypeView) != null) {
        if (typeof ref.afterRender === "function") {
          ref.afterRender();
        }
      }
      return _this.onShow();
    };
  })(this),
  showNext: (function(_this) {
    return function() {
      return _this.$el.find(".controlls").show();
    };
  })(this),
  hideNext: (function(_this) {
    return function() {
      return _this.$el.find(".controlls").hide();
    };
  })(this),
  onShow: function() {
    var displayCode, error, error1, message, name, ref;
    displayCode = this.model.getString("displayCode");
    if (!_.isEmptyString(displayCode)) {
      try {
        CoffeeScript["eval"].apply(this, [displayCode]);
      } catch (error1) {
        error = error1;
        name = (/function (.{1,})\(/.exec(error.constructor.toString())[1]);
        message = error.message;
        alert(name + "\n\n" + message);
        console.log("displayCode Error: " + JSON.stringify(error));
      }
    }
    return (ref = this.prototypeView) != null ? typeof ref.updateExecuteReady === "function" ? ref.updateExecuteReady(true) : void 0 : void 0;
  },
  getGridScore: function() {
    var grid, gridScore, link;
    link = this.model.get("gridLinkId") || "";
    if (link === "") {
      return;
    }
    grid = this.parent.model.subtests.get(this.model.get("gridLinkId"));
    gridScore = this.parent.result.getGridScore(grid.id);
    return gridScore;
  },
  gridWasAutostopped: function() {
    var grid, gridWasAutostopped, link;
    link = this.model.get("gridLinkId") || "";
    if (link === "") {
      return;
    }
    grid = this.parent.model.subtests.get(this.model.get("gridLinkId"));
    return gridWasAutostopped = this.parent.result.gridWasAutostopped(grid.id);
  },
  onClose: function() {
    var ref;
    return (ref = this.prototypeView) != null ? typeof ref.close === "function" ? ref.close() : void 0 : void 0;
  },
  isValid: function() {
    if (!this.prototypeRendered) {
      return false;
    }
    if (this.prototypeView.isValid != null) {
      return this.prototypeView.isValid();
    } else {
      return false;
    }
    return true;
  },
  showErrors: function() {
    return this.prototypeView.showErrors();
  },
  getSum: function() {
    if (this.prototypeView.getSum != null) {
      return this.prototypeView.getSum();
    } else {
      return {
        correct: 0,
        incorrect: 0,
        missing: 0,
        total: 0
      };
    }
  },
  abort: function() {
    return this.parent.abort();
  },
  getResult: function() {
    var hash, result;
    result = this.prototypeView.getResult();
    if (this.model.has("hash")) {
      hash = this.model.get("hash");
    }
    return {
      'body': result,
      'meta': {
        'hash': hash
      }
    };
  },
  getSkipped: function() {
    if (this.prototypeView.getSkipped != null) {
      return this.prototypeView.getSkipped();
    } else {
      throw "Prototype skipping not implemented";
    }
  },
  next: function() {
    return this.trigger("next");
  },
  back: function() {
    return this.trigger("back");
  },
  skip: function() {
    return this.parent.skip();
  }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvc3VidGVzdC9TdWJ0ZXN0UnVuSXRlbVZpZXcuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFDLElBQUE7O0FBQUEsa0JBQUEsR0FBcUIsUUFBUSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsTUFBN0IsQ0FFcEI7RUFBQSxPQUFBLEVBQVMsR0FBVDtFQUNBLFFBQUEsRUFBVSxHQUFJLENBQUEsb0JBQUEsQ0FEZDtFQUdBLFNBQUEsRUFBWSxvQkFIWjtFQUtBLE1BQUEsRUFDRTtJQUFBLHFCQUFBLEVBQXdCLE1BQXhCO0lBQ0EscUJBQUEsRUFBd0IsTUFEeEI7SUFFQSxxQkFBQSxFQUF3QixZQUZ4QjtJQUdBLGFBQUEsRUFBd0IsTUFIeEI7R0FORjtFQVdBLFVBQUEsRUFBWSxTQUFBO1dBQUcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxJQUFMLENBQVUsa0JBQVYsQ0FBNkIsQ0FBQyxVQUE5QixDQUF5QyxHQUF6QztFQUFILENBWFo7RUFhQSxJQUFBLEVBQU0sU0FBQTtXQUNKLElBQUMsQ0FBQSxJQUFELEdBQ0U7TUFBQSxNQUFBLEVBQVMsQ0FBQSxDQUFFLDRCQUFGLENBQVQ7TUFDQSxNQUFBLEVBQVMsQ0FBQSxDQUFFLDRCQUFGLENBRFQ7TUFFQSxNQUFBLEVBQVMsQ0FBQSxDQUFFLDRCQUFGLENBRlQ7TUFHQSxNQUFBLEVBQVMsQ0FBQSxDQUFFLDRCQUFGLENBSFQ7O0VBRkUsQ0FiTjtFQW9CQSxVQUFBLEVBQVksU0FBQyxPQUFEO0FBRVYsUUFBQTtJQUFBLElBQUMsQ0FBQSxJQUFELENBQUE7SUFFQSxJQUFDLENBQUEsS0FBRCxHQUFlLE9BQU8sQ0FBQztJQUN2QixJQUFDLENBQUEsTUFBRCxHQUFlLElBQUMsQ0FBQSxLQUFLLENBQUM7SUFDdEIsSUFBaUYsSUFBQyxDQUFBLEtBQUssQ0FBQyxHQUFQLENBQVcsWUFBWCxDQUFBLEtBQTRCLEVBQTdHO01BQUEsSUFBQyxDQUFBLFNBQUQsR0FBYSx1QkFBQSxHQUF1QixDQUFDLElB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LENBQUEsS0FBSyxDQUFDLEdBQVAsQ0FBVyxNQUFYLEVBQVA7O0FBQ0EsV0FBTztNQUNMLE1BQUEsRUFBUyxNQURKO01BRUwsTUFBQSxFQUNFO1FBQUEsTUFBQSxFQUFTLElBQVQ7T0FIRzs7RUFIRSxDQTNJWDtFQW9KQSxVQUFBLEVBQVksU0FBQTtJQUNWLElBQUcscUNBQUg7QUFDRSxhQUFPLElBQUMsQ0FBQSxhQUFhLENBQUMsVUFBZixDQUFBLEVBRFQ7S0FBQSxNQUFBO0FBR0UsWUFBTSxxQ0FIUjs7RUFEVSxDQXBKWjtFQTBKQSxJQUFBLEVBQU0sU0FBQTtXQUFHLElBQUMsQ0FBQSxPQUFELENBQVMsTUFBVDtFQUFILENBMUpOO0VBMkpBLElBQUEsRUFBTSxTQUFBO1dBQUcsSUFBQyxDQUFBLE9BQUQsQ0FBUyxNQUFUO0VBQUgsQ0EzSk47RUE0SkEsSUFBQSxFQUFNLFNBQUE7V0FBRyxJQUFDLENBQUEsTUFBTSxDQUFDLElBQVIsQ0FBQTtFQUFILENBNUpOO0NBRm9CIiwiZmlsZSI6Im1vZHVsZXMvc3VidGVzdC9TdWJ0ZXN0UnVuSXRlbVZpZXcuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIgU3VidGVzdFJ1bkl0ZW1WaWV3ID0gQmFja2JvbmUuTWFyaW9uZXR0ZS5JdGVtVmlldy5leHRlbmRcblxuICB0YWdOYW1lOiAncCdcbiAgdGVtcGxhdGU6IEpTVFtcIlN1YnRlc3RSdW5JdGVtVmlld1wiXVxuXG4gIGNsYXNzTmFtZSA6IFwiU3VidGVzdFJ1bkl0ZW1WaWV3XCJcblxuICBldmVudHM6XG4gICAgJ2NsaWNrIC5zdWJ0ZXN0LW5leHQnIDogJ25leHQnXG4gICAgJ2NsaWNrIC5zdWJ0ZXN0LWJhY2snIDogJ2JhY2snXG4gICAgJ2NsaWNrIC5zdWJ0ZXN0X2hlbHAnIDogJ3RvZ2dsZUhlbHAnXG4gICAgJ2NsaWNrIC5za2lwJyAgICAgICAgIDogJ3NraXAnXG5cbiAgdG9nZ2xlSGVscDogLT4gQCRlbC5maW5kKFwiLmVudW1lcmF0b3JfaGVscFwiKS5mYWRlVG9nZ2xlKDI1MClcblxuICBpMThuOiAtPlxuICAgIEB0ZXh0ID1cbiAgICAgIFwibmV4dFwiIDogdChcIlN1YnRlc3RSdW5WaWV3LmJ1dHRvbi5uZXh0XCIpXG4gICAgICBcImJhY2tcIiA6IHQoXCJTdWJ0ZXN0UnVuVmlldy5idXR0b24uYmFja1wiKVxuICAgICAgXCJza2lwXCIgOiB0KFwiU3VidGVzdFJ1blZpZXcuYnV0dG9uLnNraXBcIilcbiAgICAgIFwiaGVscFwiIDogdChcIlN1YnRlc3RSdW5WaWV3LmJ1dHRvbi5oZWxwXCIpXG5cbiAgaW5pdGlhbGl6ZTogKG9wdGlvbnMpIC0+XG5cbiAgICBAaTE4bigpXG5cbiAgICBAbW9kZWwgICAgICAgPSBvcHRpb25zLm1vZGVsXG4gICAgQHBhcmVudCAgICAgID0gQG1vZGVsLnBhcmVudFxuICAgIEBmb250U3R5bGUgPSBcInN0eWxlPVxcXCJmb250LWZhbWlseTogI3tAbW9kZWwuZ2V0KCdmb250RmFtaWx5Jyl9ICFpbXBvcnRhbnQ7XFxcIlwiIGlmIEBtb2RlbC5nZXQoXCJmb250RmFtaWx5XCIpICE9IFwiXCJcblxuICAgIEBwcm90b3R5cGVSZW5kZXJlZCA9IGZhbHNlXG5cbiAgICBAZGVsZWdhdGVFdmVudHMoKVxuXG4gICAgdWkgPSB7fVxuICAgIHVpLmVudW1lcmF0b3JIZWxwID0gaWYgKEBtb2RlbC5nZXQoXCJlbnVtZXJhdG9ySGVscFwiKSB8fCBcIlwiKSAhPSBcIlwiIHRoZW4gXCI8YnV0dG9uIGNsYXNzPSdzdWJ0ZXN0X2hlbHAgY29tbWFuZCc+I3tAdGV4dC5oZWxwfTwvYnV0dG9uPjxkaXYgY2xhc3M9J2VudW1lcmF0b3JfaGVscCcgI3tAZm9udFN0eWxlIHx8IFwiXCJ9PiN7QG1vZGVsLmdldCAnZW51bWVyYXRvckhlbHAnfTwvZGl2PlwiIGVsc2UgXCJcIlxuICAgIHVpLnN0dWRlbnREaWFsb2cgID0gaWYgKEBtb2RlbC5nZXQoXCJzdHVkZW50RGlhbG9nXCIpICB8fCBcIlwiKSAhPSBcIlwiIHRoZW4gXCI8ZGl2IGNsYXNzPSdzdHVkZW50X2RpYWxvZycgI3tAZm9udFN0eWxlIHx8IFwiXCJ9PiN7QG1vZGVsLmdldCAnc3R1ZGVudERpYWxvZyd9PC9kaXY+XCIgZWxzZSBcIlwiXG4gICAgdWkudHJhbnNpdGlvbkNvbW1lbnQgID0gaWYgKEBtb2RlbC5nZXQoXCJ0cmFuc2l0aW9uQ29tbWVudFwiKSAgfHwgXCJcIikgIT0gXCJcIiB0aGVuIFwiPGRpdiBjbGFzcz0nc3R1ZGVudF9kaWFsb2cnICN7QGZvbnRTdHlsZSB8fCBcIlwifT4je0Btb2RlbC5nZXQgJ3RyYW5zaXRpb25Db21tZW50J308L2Rpdj4gPGJyPlwiIGVsc2UgXCJcIlxuXG4gICAgc2tpcHBhYmxlID0gQG1vZGVsLmdldChcInNraXBwYWJsZVwiKSA9PSB0cnVlIHx8IEBtb2RlbC5nZXQoXCJza2lwcGFibGVcIikgPT0gXCJ0cnVlXCJcbiAgICBiYWNrYWJsZSA9ICggQG1vZGVsLmdldChcImJhY2tCdXR0b25cIikgPT0gdHJ1ZSB8fCBAbW9kZWwuZ2V0KFwiYmFja0J1dHRvblwiKSA9PSBcInRydWVcIiApIGFuZCBAcGFyZW50LmluZGV4IGlzbnQgMFxuXG4gICAgdWkuc2tpcEJ1dHRvbiA9IFwiPGJ1dHRvbiBjbGFzcz0nc2tpcCBuYXZpZ2F0aW9uJz4je0B0ZXh0LnNraXB9PC9idXR0b24+XCIgaWYgc2tpcHBhYmxlXG4gICAgdWkuYmFja0J1dHRvbiA9IFwiPGJ1dHRvbiBjbGFzcz0nc3VidGVzdC1iYWNrIG5hdmlnYXRpb24nPiN7QHRleHQuYmFja308L2J1dHRvbj5cIiBpZiBiYWNrYWJsZVxuICAgIHVpLnRleHQgPSBAdGV4dFxuICAgIEBtb2RlbC5zZXQoJ3VpJywgdWkpXG5cbiAgb25SZW5kZXI6IC0+XG5cbiAgICBfcmVuZGVyID0gPT5cblxuICAgICAgIyBQcm90b3R5cGUgc3BlY2lmaWMgdmlld3MgZm9sbG93IHRoaXMgY2FwaXRhbGl6YXRpb24gY29udmVudGlvbjogR3BzUnVuVmlld1xuICAgICAgY29uc29sZS5sb2cgQG1vZGVsXG4gICAgICBAcHJvdG90eXBlVmlldyA9IG5ldyB3aW5kb3dbXCIje0Btb2RlbC5nZXQoJ3Byb3RvdHlwZScpLnRpdGxlaXplKCl9UnVuVmlld1wiXVxuICAgICAgICBtb2RlbCAgOiBAbW9kZWxcbiAgICAgICAgcGFyZW50IDogQFxuICAgICAgQHByb3RvdHlwZVZpZXcub24gXCJyZW5kZXJlZFwiLCAgICA9PiBAZmxhZ1JlbmRlcihcInByb3RvdHlwZVwiKVxuICAgICAgQHByb3RvdHlwZVZpZXcub24gXCJzdWJSZW5kZXJlZFwiLCA9PiBAdHJpZ2dlciBcInN1YlJlbmRlcmVkXCJcbiAgICAgIEBwcm90b3R5cGVWaWV3Lm9uIFwic2hvd05leHRcIiwgICAgPT4gQHNob3dOZXh0KClcbiAgICAgIEBwcm90b3R5cGVWaWV3Lm9uIFwiaGlkZU5leHRcIiwgICAgPT4gQGhpZGVOZXh0KClcbiAgICAgIEBwcm90b3R5cGVWaWV3Lm9uIFwicmVhZHlcIiwgICAgICAgPT4gQHByb3RvdHlwZVJlbmRlcmVkID0gdHJ1ZVxuICAgICAgQHByb3RvdHlwZVZpZXcuc2V0RWxlbWVudChAJGVsLmZpbmQoJyNwcm90b3R5cGVfd3JhcHBlcicpKVxuICAgICAgQHByb3RvdHlwZVZpZXcucmVuZGVyKClcblxuICAgICAgQGZsYWdSZW5kZXIgXCJzdWJ0ZXN0XCJcblxuICAgIGxhbmd1YWdlQ29kZSA9IEBtb2RlbC5nZXQoXCJsYW5ndWFnZVwiKVxuICAgIGlmIGxhbmd1YWdlQ29kZVxuICAgICAgaTE4bi5zZXRMbmcgbGFuZ3VhZ2VDb2RlLCAodCkgPT5cbiAgICAgICAgd2luZG93LnQgPSB0XG4gICAgICAgIF9yZW5kZXIoKVxuICAgIGVsc2VcbiAgICAgIGkxOG4uc2V0TG5nIFRhbmdlcmluZS5zZXR0aW5ncy5nZXQoXCJsYW5ndWFnZVwiKSwgKHQpID0+XG4gICAgICAgIF9yZW5kZXIoKVxuXG4gIGZsYWdSZW5kZXI6ICggZmxhZyApID0+XG4gICAgQHJlbmRlckZsYWdzID0ge30gaWYgbm90IEByZW5kZXJGbGFnc1xuICAgIEByZW5kZXJGbGFnc1tmbGFnXSA9IHRydWVcblxuICAgIGlmIEByZW5kZXJGbGFnc1snc3VidGVzdCddICYmIEByZW5kZXJGbGFnc1sncHJvdG90eXBlJ11cbiAgICAgIEB0cmlnZ2VyIFwicmVuZGVyZWRcIlxuXG4gIGFmdGVyUmVuZGVyOiA9PlxuICAgIEBwcm90b3R5cGVWaWV3Py5hZnRlclJlbmRlcj8oKVxuICAgIEBvblNob3coKVxuXG4gIHNob3dOZXh0OiA9PiBAJGVsLmZpbmQoXCIuY29udHJvbGxzXCIpLnNob3coKVxuICBoaWRlTmV4dDogPT4gQCRlbC5maW5kKFwiLmNvbnRyb2xsc1wiKS5oaWRlKClcblxuICBvblNob3c6IC0+XG4gICAgZGlzcGxheUNvZGUgPSBAbW9kZWwuZ2V0U3RyaW5nKFwiZGlzcGxheUNvZGVcIilcblxuICAgIGlmIG5vdCBfLmlzRW1wdHlTdHJpbmcoZGlzcGxheUNvZGUpXG5cbiAgICAgIHRyeVxuICAgICAgICBDb2ZmZWVTY3JpcHQuZXZhbC5hcHBseShALCBbZGlzcGxheUNvZGVdKVxuICAgICAgY2F0Y2ggZXJyb3JcbiAgICAgICAgbmFtZSA9ICgoL2Z1bmN0aW9uICguezEsfSlcXCgvKS5leGVjKGVycm9yLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkpWzFdKVxuICAgICAgICBtZXNzYWdlID0gZXJyb3IubWVzc2FnZVxuICAgICAgICBhbGVydCBcIiN7bmFtZX1cXG5cXG4je21lc3NhZ2V9XCJcbiAgICAgICAgY29uc29sZS5sb2cgXCJkaXNwbGF5Q29kZSBFcnJvcjogXCIgKyBKU09OLnN0cmluZ2lmeShlcnJvcilcblxuICAgIEBwcm90b3R5cGVWaWV3Py51cGRhdGVFeGVjdXRlUmVhZHk/KHRydWUpXG5cbiAgZ2V0R3JpZFNjb3JlOiAtPlxuICAgIGxpbmsgPSBAbW9kZWwuZ2V0KFwiZ3JpZExpbmtJZFwiKSB8fCBcIlwiXG4gICAgaWYgbGluayA9PSBcIlwiIHRoZW4gcmV0dXJuXG4gICAgZ3JpZCA9IEBwYXJlbnQubW9kZWwuc3VidGVzdHMuZ2V0IEBtb2RlbC5nZXQoXCJncmlkTGlua0lkXCIpXG4gICAgZ3JpZFNjb3JlID0gQHBhcmVudC5yZXN1bHQuZ2V0R3JpZFNjb3JlIGdyaWQuaWRcbiAgICBncmlkU2NvcmVcblxuICBncmlkV2FzQXV0b3N0b3BwZWQ6IC0+XG4gICAgbGluayA9IEBtb2RlbC5nZXQoXCJncmlkTGlua0lkXCIpIHx8IFwiXCJcbiAgICBpZiBsaW5rID09IFwiXCIgdGhlbiByZXR1cm5cbiAgICBncmlkID0gQHBhcmVudC5tb2RlbC5zdWJ0ZXN0cy5nZXQgQG1vZGVsLmdldChcImdyaWRMaW5rSWRcIilcbiAgICBncmlkV2FzQXV0b3N0b3BwZWQgPSBAcGFyZW50LnJlc3VsdC5ncmlkV2FzQXV0b3N0b3BwZWQgZ3JpZC5pZFxuXG4gIG9uQ2xvc2U6IC0+XG4gICAgQHByb3RvdHlwZVZpZXc/LmNsb3NlPygpXG5cbiAgaXNWYWxpZDogLT5cbiAgICBpZiBub3QgQHByb3RvdHlwZVJlbmRlcmVkIHRoZW4gcmV0dXJuIGZhbHNlXG4gICAgaWYgQHByb3RvdHlwZVZpZXcuaXNWYWxpZD9cbiAgICAgIHJldHVybiBAcHJvdG90eXBlVmlldy5pc1ZhbGlkKClcbiAgICBlbHNlXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB0cnVlXG5cbiAgc2hvd0Vycm9yczogLT5cbiAgICBAcHJvdG90eXBlVmlldy5zaG93RXJyb3JzKClcblxuICBnZXRTdW06IC0+XG4gICAgaWYgQHByb3RvdHlwZVZpZXcuZ2V0U3VtP1xuICAgICAgcmV0dXJuIEBwcm90b3R5cGVWaWV3LmdldFN1bSgpXG4gICAgZWxzZVxuICAgICAgIyBtYXliZSBhIGJldHRlciBmYWxsYmFja1xuICAgICAgcmV0dXJuIHtjb3JyZWN0OjAsaW5jb3JyZWN0OjAsbWlzc2luZzowLHRvdGFsOjB9XG5cbiAgYWJvcnQ6IC0+XG4gICAgQHBhcmVudC5hYm9ydCgpXG5cbiAgZ2V0UmVzdWx0OiAtPlxuICAgIHJlc3VsdCA9IEBwcm90b3R5cGVWaWV3LmdldFJlc3VsdCgpXG4gICAgaGFzaCA9IEBtb2RlbC5nZXQoXCJoYXNoXCIpIGlmIEBtb2RlbC5oYXMoXCJoYXNoXCIpXG4gICAgcmV0dXJuIHtcbiAgICAgICdib2R5JyA6IHJlc3VsdFxuICAgICAgJ21ldGEnIDpcbiAgICAgICAgJ2hhc2gnIDogaGFzaFxuICAgIH1cblxuICBnZXRTa2lwcGVkOiAtPlxuICAgIGlmIEBwcm90b3R5cGVWaWV3LmdldFNraXBwZWQ/XG4gICAgICByZXR1cm4gQHByb3RvdHlwZVZpZXcuZ2V0U2tpcHBlZCgpXG4gICAgZWxzZVxuICAgICAgdGhyb3cgXCJQcm90b3R5cGUgc2tpcHBpbmcgbm90IGltcGxlbWVudGVkXCJcblxuICBuZXh0OiAtPiBAdHJpZ2dlciBcIm5leHRcIlxuICBiYWNrOiAtPiBAdHJpZ2dlciBcImJhY2tcIlxuICBza2lwOiAtPiBAcGFyZW50LnNraXAoKVxuIl19
